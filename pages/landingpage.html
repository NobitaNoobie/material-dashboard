<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="../assets/img/favicon.png">
    <title>
        Material Dashboard 2 by Creative Tim
    </title>
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Roboto+Slab:400,700" />
    <!-- Nucleo Icons -->
    <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <!-- CSS Files -->
    <link id="pagestyle" href="../assets/css/material-dashboard.css?v=3.1.0" rel="stylesheet" />
    <link href="../assets/css/new.css" rel="stylesheet" />
    <!-- Nepcha Analytics (nepcha.com) -->
    <!-- Nepcha is a easy-to-use web analytics. No cookies and fully compliant with GDPR, CCPA and PECR. -->
    <script defer data-site="YOUR_DOMAIN_HERE" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body class="g-sidenav-show  bg-gray-200">
    <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
        <!-- Navbar add from testing.html -->

        <!-- End Navbar -->

        <div class="container-fluid py-4">
            <div class="row">
                <!-- STYLE OF LEAVE APPLICATIONS TODAY -->
                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <div class="card-header p-3 pt-2">
                            <div
                                class="icon icon-lg icon-shape bg-gradient-secondary shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                                <i class="material-icons opacity-10">description</i>
                            </div>
                            <div class="text-end pt-1">
                                <p class="text-sm opacity-8 text-secondary font-weight-bold mb-0 text-capitalize">Leave
                                    applications today</p>
                                <!-- <h4 id="leave-count" class="mb-0" data-bs-toggle="modal" data-bs-target="#leave-modal">
                                    ...</h4> -->
                                <h4 id="leave-count" class="mb-0">
                                    ...
                                </h4>
                            </div>
                        </div>
                        <hr class="dark horizontal my-0">
                        <div class="card-footer p-3">
                            <p class="mb-0"><span id="leave-applications-relative"
                                    class="text-sm font-weight-bolder">... </span> than last week</p>
                        </div>
                    </div>
                </div>
                <!-- Modal Structure -->
                <div id="leave-modal" class="modal fade" tabindex="-1" aria-labelledby="leave-modal-label">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="leave-modal-label">Today's Leave Applicants</h1>
                                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"
                                    style="background: none; border: none; font-size: 1.5rem; line-height: 1;">
                                    &times;
                                </button>
                            </div>
                            <div class="modal-body">
                                <table id="leave-table" class="table table-responsive text-center">
                                    <thead>
                                        <tr>
                                            <th class="text text-info opacity-8">Emp Id</th>
                                            <th class="text text-info opacity-8">Name</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SCRIPT of LEAVE APPLICATIONS TODAY -->
                <script type="text/javascript">
                    $(document).ready(
                        function () {
                            // 'default' to revert
                            console.log("Inside NUM LEAVE APPLICATIONS")
                            function getISTDate(date) {
                                // Calculate the IST date (UTC+5:30)
                                //5.5hr * 60mins * 60secs * 1000 ms
                                let istOffset = 5.5 * 60 * 60 * 1000; // IST offset in milliseconds
                                let istDate = new Date(date.getTime() - istOffset);
                                return istDate;
                            }

                            let today = new Date(); //today's date
                            // today = getISTDate(today);
                            console.log(today);
                            let formattedDate = today.toISOString().split('T')[0];

                            $.get('http://127.0.0.1:8000/abc/leave_applications_on_today/', { date: formattedDate })
                                .done(
                                    function (response) {
                                        if (response.status === 1) {
                                            let employeeCount = response.msg; //captures the msg field in the Response json
                                            let employeeList = response.list;
                                            $('#leave-count').text(employeeCount);
                                            if (employeeCount > 0) {
                                                $("#leave-count").hover(function () {
                                                    $('#leave-count').css('cursor', 'pointer');
                                                }, function () {
                                                    $('#leave-count').css('cursor', 'default');
                                                });

                                                $('#leave-count').on('click', function () {
                                                    let tableBody = $('#leave-table tbody');
                                                    tableBody.empty(); // Clear existing data

                                                    employeeList.forEach(function (employee) {
                                                        let row = $('<tr>');
                                                        row.append($('<td>').text(employee.Staff_id));
                                                        row.append($('<td>').text(employee.Name));
                                                        tableBody.append(row);
                                                    });

                                                    $('#leave-modal').modal('show');
                                                });
                                                $('.modal-close').on('click', function () {
                                                    $('#leave-modal').hide();
                                                });
                                                // $('.modal-close').on('click', function () {
                                                //     $('#today-leave-modal').hide();
                                                // });
                                            }
                                            else {
                                                console.log("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA");
                                                $("#leave-count").css('cursor', 'default');
                                                $('#leave-count').off('click');
                                            }

                                        }
                                        else {
                                            console.error("Error: ", response.error);
                                        }
                                    }
                                )
                                .fail(
                                    function (error) {
                                        console.error("Error fetching data: ", error);
                                    }
                                );
                        }
                    );
                </script>

                <!-- SCRIPT of RELATIVE LEAVE APPLICATIONS RATE -->
                <script type="text/javascript">
                    $(document).ready(
                        function () {
                            console.log("Inside RELATIVE application RATE");
                            function getISTDate(date) {
                                let istOffset = 5.5 * 60 * 60 * 1000;
                                let istDate = new Date(date.getTime() + istOffset);
                                return istDate;
                            }

                            let today = new Date(); //today's date
                            // today = getISTDate(today);

                            let formattedDate = today.toISOString().split('T')[0]; console.log(formattedDate);
                            // getMonth() results in 0-indexed,i.e., January = 0
                            console.log("MONTH ", today.getMonth() + 1); //remember to add 1 to avoid errors
                            console.log("YEAR: ", today.getFullYear());
                            $.get(`http://127.0.0.1:8000/abc/leave_applications_on_today/`, { date: formattedDate })
                                .done(
                                    function (response) {
                                        if (response.status === 1) {
                                            //let diffval = -1;
                                            let diffval = Math.round(response.diff); //captures the diff field in the Response json
                                            console.log("rel leave application: ", diffval);
                                            let diffstr = diffval >= 0 ? `+${diffval}` : `${diffval}`;
                                            $('#leave-applications-relative').text(diffstr);
                                            // Set text color based on diffval (assuming positive diff indicates higher rate)
                                            $('#leave-applications-relative').css("color", diffval >= 0 ? "#4CAF50" : "#F44335");
                                        } else {
                                            console.error("Error: ", response.error);
                                        }
                                    }
                                )
                                .fail(
                                    function (error) {
                                        console.error("Error fetching data: ", error);
                                    }
                                );
                        }
                    );
                </script>

                <!-- STYLE OF ABSENTEES -->
                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <!-- CARD HEADER -->
                        <div class="card-header p-4 pt-2">
                            <div
                                class="icon icon-lg icon-shape bg-gradient-primary shadow-primary text-center border-radius-xl mt-n4 position-absolute">
                                <i class="material-icons opacity-10">people</i>
                            </div>

                            <div class="text-end pt-1">
                                <p class="text-sm opacity-7 text-primary mb-0 text-capitalize font-weight-bold">
                                    employees on leave</p>
                            </div>
                        </div>
                        <!-- SUB-CARDS ROW -->
                        <div class="card-body py-1 d-flex justify-content-between">
                            <!-- TOMORROW SUB-CARD -->
                            <div class="col-xl-4 col-sm-4">
                                <div class="h-100">

                                    <div class="text-end pt-1">
                                        <p class="text-sm mb-0 text-capitalize">Tomorrow</p>
                                        <h4 id="employee-count-tomorrow" class="mb-0">...</h4>
                                    </div>

                                    <div class="card-footer p-2"></div>
                                </div>
                            </div>
                            <!-- TODAY SUB-CARD -->
                            <div class="col-xl-4 col-sm-4">
                                <div class="h-100">

                                    <div class="text-end pt-1">
                                        <p class="text-sm mb-0 text-capitalize">Today</p>
                                        <h4 id="employee-count" class="mb-0">...</h4>
                                    </div>

                                    <div class="card-footer p-2"></div>
                                </div>
                            </div>
                            <!-- JUNE SUB-CARD -->
                            <div class="col-xl-4 col-sm-4">
                                <div class="h-100">

                                    <div class="text-end pt-1">
                                        <p class="text-sm mb-0 text-capitalize"><span id="curr-month">...</p>
                                        <h4 id="employee-count-future" class="mb-0">...</h4>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- TOMORROW LEAVE MODAL -->
                <div id="tom-leave-modal" class="modal fade" tabindex="-1" aria-labelledby="tom-leave-modal-label">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="tom-leave-modal-label">On Leave Tomorrow</h1>
                                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"
                                    style="background: none; border: none; font-size: 1.5rem; line-height: 1;">
                                    &times;
                                </button>
                            </div>
                            <div class="modal-body">
                                <table id="tom-leave-table" class="table table-responsive text-center">
                                    <thead>
                                        <tr>
                                            <th class="text text-info opacity-8">Emp Id</th>
                                            <th class="text text-info opacity-8">Name</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TODAY LEAVE MODAL -->
                <div id="today-leave-modal" class="modal fade" tabindex="-1" aria-labelledby="today-leave-modal-label">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="today-leave-modal-label">On Leave Today</h1>
                                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"
                                    style="background: none; border: none; font-size: 1.5rem; line-height: 1;">
                                    &times;
                                </button>
                            </div>
                            <div class="modal-body">
                                <table id="today-leave-table" class="table table-responsive text-center">
                                    <thead>
                                        <tr>
                                            <th class="text text-info opacity-8">Emp Id</th>
                                            <th class="text text-info opacity-8">Name</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MONTH LEAVE MODAL -->
                <div id="month-leave-modal" class="modal fade" tabindex="-1" aria-labelledby="month-leave-modal-label">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5 text-capitalize" id="month-leave-modal-label">on leave in
                                    <span id="curr-month-modal">...
                                </h1>
                                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close"
                                    style="background: none; border: none; font-size: 1.5rem; line-height: 1;">
                                    &times;
                                </button>
                            </div>
                            <div class="modal-body">
                                <table id="month-leave-table" class="table table-responsive text-center">
                                    <thead>
                                        <tr>
                                            <th class="text text-info opacity-8">Emp Id</th>
                                            <th class="text text-info opacity-8">Name</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SCRIPT OF TODAY ABSENTEES -->
                <script type="text/javascript">
                    $(document).ready(
                        function () {
                            console.log("Inside TODAY NUM ABSENTEES")
                            function getISTDate(date) {
                                // Calculate the IST date (UTC+5:30)
                                let istOffset = 5.5 * 60 * 60 * 1000; // IST offset in milliseconds
                                let istDate = new Date(date.getTime() + istOffset);
                                return istDate;
                            }

                            let today = new Date(); //today's date
                            console.log("Today: ", today); // 2024-06-11T17:25:55.099Z
                            let formattedDate = today.toISOString().split('T')[0];

                            $.get('http://127.0.0.1:8000/abc/num_employees_on_leave_today/', { date: formattedDate })
                                .done(
                                    function (response) {
                                        if (response.status === 1) {
                                            let employeeCount = response.msg; //captures the msg field in the Response json
                                            let employeeList = response.list;
                                            $('#employee-count').text(employeeCount);
                                            if (employeeCount > 0) {
                                                $("#employee-count").hover(function () {
                                                    $('#employee-count').css('cursor', 'pointer');
                                                }, function () {
                                                    $('#employee-count').css('cursor', 'default');
                                                });
                                                $('#employee-count').on('click', function () {
                                                    let tableBody = $('#today-leave-table tbody');
                                                    tableBody.empty(); // Clear existing data

                                                    employeeList.forEach(function (employee) {
                                                        let row = $('<tr>');
                                                        row.append($('<td>').text(employee.Staff_id));
                                                        row.append($('<td>').text(employee.Name));
                                                        tableBody.append(row);
                                                    });
                                                    $('#today-leave-modal').modal('show');
                                                });
                                                $('.modal-close').on('click', function () {
                                                    $('#today-leave-modal').modal('hide');
                                                });
                                            }
                                            else {
                                                $("#employee-count").css('cursor', 'default');
                                                $('#employee-count').off('click');
                                            }
                                        }
                                        else {
                                            console.error("Error: ", response.error);
                                        }
                                    }
                                )
                                .fail(
                                    function (error) {
                                        console.error("Error fetching data: ", error);
                                    }
                                );
                        }
                    );
                </script>

                <!-- SCRIPT OF TOMORROW ABSENTEES -->
                <script type="text/javascript">
                    $(document).ready(
                        function () {
                            console.log("Inside TOMORROW NUM ABSENTEES");
                            function getISTDate(date) {
                                // Calculate the IST date (UTC+5:30)
                                let istOffset = 5.5 * 60 * 60 * 1000; // IST offset in milliseconds
                                let istDate = new Date(date.getTime() + istOffset);
                                return istDate;
                            }

                            let today = new Date(); //today's date
                            let tomorrow = new Date(today);
                            tomorrow.setDate(today.getDate() + 1);
                            console.log(tomorrow);
                            let formattedTomorrow = tomorrow.toISOString().split('T')[0]; // Format tomorrow's date
                            console.log("Tomorrow: ", formattedTomorrow);

                            $.get(`http://127.0.0.1:8000/abc/num_employees_on_leave_on_day/${formattedTomorrow}/`)
                                .done(
                                    function (response) {
                                        if (response.status === 1) {
                                            //let employeeCount = 0;
                                            let employeeCount = response.msg; //captures the msg field in the Response json
                                            let employeeList = response.list;
                                            $('#employee-count-tomorrow').text(employeeCount);
                                            if (employeeCount > 0) {
                                                $("#employee-count-tomorrow").hover(function () {
                                                    $('#employee-count-tomorrow').css('cursor', 'pointer');
                                                }, function () {
                                                    $('#employee-count-tomorrow').css('cursor', 'default');
                                                });
                                                $('#employee-count-tomorrow').on('click', function () {
                                                    let tableBody = $('#tom-leave-table tbody');
                                                    tableBody.empty(); // Clear existing data

                                                    employeeList.forEach(function (employee) {
                                                        let row = $('<tr>');
                                                        row.append($('<td>').text(employee.Staff_Id));
                                                        row.append($('<td>').text(employee.Name));
                                                        tableBody.append(row);
                                                    });

                                                    $('#tom-leave-modal').modal('show');
                                                });
                                                $('.modal-close').on('click', function () {
                                                    $('#tom-leave-modal').modal('hide');
                                                });
                                            }
                                            else {
                                                $("#employee-count-tomorrow").css('cursor', 'default');
                                                $('#employee-count-tomorrow').off('click');
                                            }
                                        }
                                        else {
                                            console.error("Error: ", response.error);
                                        }
                                    }
                                )
                                .fail(
                                    function (error) {
                                        console.error("Error fetching data: ", error);
                                    }
                                );
                        }
                    );
                </script>

                <!-- jQuery absentees in the current month -->
                <script type="text/javascript">
                    $(document).ready(
                        function () {
                            function getISTDate(date) {
                                // Calculate the IST date (UTC+5:30)
                                //5.5hr * 60mins * 60secs * 1000 ms
                                let istOffset = 5.5 * 60 * 60 * 1000; // IST offset in milliseconds
                                let istDate = new Date(date.getTime() + istOffset);
                                return istDate;
                            }

                            //Calculate today's date
                            let today = new Date();
                            today = getISTDate(today);
                            console.log(today);
                            console.log(today.toISOString());
                            let formattedDate = today.toISOString().split('T')[0];
                            //extract month
                            let monthNames = [
                                "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"
                            ];
                            let monthName = monthNames[today.getMonth()];

                            $.get('http://127.0.0.1:8000/abc/num_employees_on_leave_monthly/', { date: formattedDate })
                                .done(
                                    function (response) {
                                        if (response.status === 1) {
                                            let employeeCount = response.msg; //captures the msg field in the Response json
                                            $('#employee-count-future').text(employeeCount);
                                            $('#curr-month').text(monthName);
                                            $('#curr-month-modal').text(monthName);
                                            let employeeList = response.list;
                                            if (employeeCount > 0) {
                                                $("#employee-count-future").hover(function () {
                                                    $('#employee-count-future').css('cursor', 'pointer');
                                                }, function () {
                                                    $('#employee-count-future').css('cursor', 'default');
                                                });
                                                $('#employee-count-future').on('click', function () {
                                                    let tableBody = $('#month-leave-table tbody');
                                                    tableBody.empty(); // Clear existing data

                                                    employeeList.forEach(function (employee) {
                                                        let row = $('<tr>');
                                                        row.append($('<td>').text(employee.Staff_Id));
                                                        row.append($('<td>').text(employee.Name));
                                                        tableBody.append(row);
                                                    });

                                                    $('#month-leave-modal').modal('show');
                                                });
                                                $('.modal-close').on('click', function () {
                                                    $('#month-leave-modal').modal('hide');
                                                });
                                            }
                                            else {
                                                $("#employee-count-future").css('cursor', 'default');
                                                $('#employee-count-future').off('click');
                                            }
                                        }
                                        else {
                                            console.error("Error: ", response.error);
                                        }
                                    }
                                )
                                .fail(
                                    function (error) {
                                        console.error("Error fetching data: ", error);
                                    }
                                );
                        }
                    );
                </script>


                <!-- STYLE OF PLANNED/UNPLANNED -->
                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <!-- CARD HEADER -->
                        <div class="card-header p-3 pt-2">
                            <div
                                class="icon icon-lg icon-shape bg-gradient-warning shadow-primary text-center border-radius-xl mt-n4 position-absolute">
                                <i class="material-icons opacity-10">leaderboard</i>
                            </div>

                            <div class="text-end pt-1">
                                <p class="text-sm text-warning opacity-6 mb-0 text-capitalize font-weight-bold">Leave
                                    distribution
                                </p>
                            </div>
                        </div>

                        <!-- SUB-CARDS ROW -->
                        <div class="card-body py-3 d-flex justify-content-between">
                            <div class="col-xl-6 col-sm-6">
                                <div class="h-100">
                                    <div class="text-end pt-1">
                                        <p class="text-sm mb-0 text-capitalize">Planned</p>
                                        <h4 id="planned-count" class="mb-0">...</h4>
                                    </div>
                                </div>
                            </div>

                            <div class="col-xl-6 col-sm-6">
                                <div class="h-100">
                                    <div class="text-end pt-1">
                                        <p class="text-sm mb-0 text-capitalize">Unplanned</p>
                                        <h4 id="unplanned-count" class="mb-0">...</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- UNPLANNED LEAVES COUNT -->
                <script type="text/javascript">
                    $(document).ready(
                        function () {
                            console.log("Inside PLANNED-UNPLANNED LEAVES");
                            function getISTDate(date) {
                                let istOffset = 5.5 * 60 * 60 * 1000; // IST offset in milliseconds
                                let istDate = new Date(date.getTime() + istOffset);
                                return istDate;
                            }

                            let today = new Date(); //today's date
                            let formattedDate = today.toISOString().split('T')[0]; console.log("Today: ", formattedDate);

                            $.get('http://127.0.0.1:8000/abc/unplanned_leaves/', { date: formattedDate })
                                .done(
                                    function (response) {
                                        if (response.status === 1) {
                                            let unplannedCount = response.msg;
                                            $('#unplanned-count').text(unplannedCount + ' %');
                                        }
                                        else {
                                            console.error("Error: ", response.error);
                                        }
                                    }
                                )
                                .fail(
                                    function (error) {
                                        console.error("Error fetching data: ", error);
                                    }
                                );
                        }
                    );
                </script>

                <!-- PLANNED LEAVES COUNT -->
                <script type="text/javascript">
                    $(document).ready(
                        function () {
                            console.log("Inside PLANNED-UNPLANNED LEAVES");
                            function getISTDate(date) {
                                let istOffset = 5.5 * 60 * 60 * 1000; // IST offset in milliseconds
                                let istDate = new Date(date.getTime() + istOffset);
                                return istDate;
                            }

                            let today = new Date(); //today's date
                            let formattedDate = today.toISOString().split('T')[0]; console.log("Today: ", formattedDate);

                            $.get('http://127.0.0.1:8000/abc/planned_leaves/', { date: formattedDate })
                                .done(
                                    function (response) {
                                        if (response.status === 1) {
                                            let plannedCount = response.msg;
                                            $('#planned-count').text(plannedCount + ' %');
                                        }
                                        else {
                                            console.error("Error: ", response.error);
                                        }
                                    }
                                )
                                .fail(
                                    function (error) {
                                        console.error("Error fetching data: ", error);
                                    }
                                );
                        }
                    );
                </script>

                <!-- STYLE of LEAVES RATE -->
                <div class="col-xl-3 col-sm-6">
                    <div class="card">
                        <div class="card-header p-3 pt-2">
                            <div
                                class="icon icon-lg icon-shape bg-gradient-info shadow-info text-center border-radius-xl mt-n4 position-absolute">
                                <i class="material-icons opacity-10">percent</i>
                            </div>
                            <div class="text-end pt-1">
                                <p class="text-sm text-info opacity-6 font-weight-bold mb-0 text-capitalize">
                                    <span>leave rate in <span id="absenteeism-rate-month">
                                </p>
                                <h4 id="absenteeism-rate" class="mb-0">...</h4>
                            </div>
                        </div>
                        <hr class="dark horizontal my-0">
                        <div class="card-footer p-3">
                            <p class="mb-0"><span id="absenteeism-rate-relative-more"
                                    class="text-sm font-weight-bolder">... </span> than last month</p>
                        </div>
                    </div>
                </div>

                <!-- SCRIPT of ABSENTEEISM RATE -->
                <script type="text/javascript">
                    $(document).ready(
                        function () {
                            console.log("Inside ABSENTEEISM RATE");
                            function getISTDate(date) {
                                // Calculate the IST date (UTC+5:30)
                                //5.5hr * 60mins * 60secs * 1000 ms
                                let istOffset = 5.5 * 60 * 60 * 1000; // IST offset in milliseconds
                                let istDate = new Date(date.getTime() + istOffset);
                                return istDate;
                            }

                            let today = new Date(); //today's date
                            // today = getISTDate(today);
                            console.log(today.toISOString());
                            console.log("LOLLLLLLL", today);

                            let formattedDate = today.toISOString().split('T')[0];
                            let months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                            let month = months[today.getMonth()]
                            console.log("MONTH for absenteeism rate: ", month);

                            $.get(`http://127.0.0.1:8000/abc/absenteeism_rate_relative/${today.getMonth() + 1}/${today.getFullYear()}`, { date: formattedDate })
                                .done(
                                    function (response) {
                                        if (response.status === 1) {
                                            let employeeCount = response.curr; //captures the msg field in the Response json
                                            $('#absenteeism-rate').text(employeeCount + ' %');
                                            $('#absenteeism-rate-month').text(month);
                                        }
                                        else {
                                            console.error("Error: ", response.error);
                                        }
                                    }
                                )
                                .fail(
                                    function (error) {
                                        console.error("Error fetching data: ", error);
                                    }
                                );
                        }
                    );
                </script>

                <!-- SCRIPT of RELATIVE ABSENTEEISM RATE -->
                <script type="text/javascript">
                    $(document).ready(
                        function () {
                            console.log("Inside RELATIVE ABSENTEEISM RATE");
                            function getISTDate(date) {
                                let istOffset = 5.5 * 60 * 60 * 1000;
                                let istDate = new Date(date.getTime() + istOffset);
                                return istDate;
                            }

                            let today = new Date(); //today's date
                            today = getISTDate(today);

                            let formattedDate = today.toISOString().split('T')[0]; console.log(formattedDate);
                            // getMonth() results in 0-indexed,i.e., January = 0
                            console.log("MONTH ", today.getMonth() + 1); //remember to add 1 to avoid errors
                            console.log("YEAR: ", today.getFullYear());
                            $.get(`http://127.0.0.1:8000/abc/absenteeism_rate_relative/${today.getMonth() + 1}/${today.getFullYear()}`)
                                .done(
                                    function (response) {
                                        if (response.status === 1) {
                                            //let diffval = -1;
                                            let diffval = Math.round(response.diff); //captures the diff field in the Response json
                                            let diffstr = diffval >= 0 ? `+${diffval}` : `${diffval}`;
                                            $('#absenteeism-rate-relative-more').text(diffstr + '%');
                                            // Set text color based on diffval (assuming positive diff indicates higher rate)
                                            $('#absenteeism-rate-relative-more').css("color", diffval > 0 ? "#4CAF50" : "#F44335");
                                        } else {
                                            console.error("Error: ", response.error);
                                        }
                                    }
                                )
                                .fail(
                                    function (error) {
                                        console.error("Error fetching data: ", error);
                                    }
                                );
                        }
                    );
                </script>

            </div>
            <!-- add THE SECTION BELOW THE CARDS from testing.html here -->

            <div class="row mt-4">
                <div class="col-lg-6 col-md-6 mt-4 mb-4">
                    <div class="card z-index-2 ">
                        <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2 bg-transparent">
                            <div class="bg-gradient-primary opacity-9 shadow-primary border-radius-lg py-3 pe-1">
                                <div class="chart">
                                    <canvas id="chart-bars" class="chart-canvas" height="170"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h6 class="mb-0 text-capitalize">weekly Leave Distribution</h6>
                            <p class="text-sm ">Last Campaign Performance</p>
                            <hr class="dark horizontal">
                            <div class="d-flex ">
                                <i class="material-icons text-sm my-auto me-1">schedule</i>
                                <p class="mb-0 text-sm"> campaign sent 2 days ago </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6 col-md-6 mt-4 mb-4">
                    <div class="card z-index-2  ">
                        <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2 bg-transparent">
                            <div class="bg-gradient-success opacity-9 shadow-success border-radius-lg py-3 pe-1">
                                <div class="chart">
                                    <canvas id="chart-line" class="chart-canvas" height="170"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <h6 class="mb-0 text-capitalize"> monthly absenteeism rate </h6>
                            <p class="text-sm "> (<span class="font-weight-bolder">+15%</span>) increase in today sales.
                            </p>
                            <hr class="dark horizontal">
                            <div class="d-flex ">
                                <i class="material-icons text-sm my-auto me-1">schedule</i>
                                <p class="mb-0 text-sm"> updated 4 min ago </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <div class="fixed-plugin">
        <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
            <i class="material-icons py-2">settings</i>
        </a>
        <div class="card shadow-lg">
            <div class="card-header pb-0 pt-3">
                <div class="float-start">
                    <h5 class="mt-3 mb-0">Material UI Configurator</h5>
                    <p>See our dashboard options.</p>
                </div>
                <div class="float-end mt-4">
                    <button class="btn btn-link text-dark p-0 fixed-plugin-close-button">
                        <i class="material-icons">clear</i>
                    </button>
                </div>
                <!-- End Toggle Button -->
            </div>
            <hr class="horizontal dark my-1">
            <div class="card-body pt-sm-3 pt-0">
                <!-- Sidebar Backgrounds -->
                <div>
                    <h6 class="mb-0">Sidebar Colors</h6>
                </div>
                <a href="javascript:void(0)" class="switch-trigger background-color">
                    <div class="badge-colors my-2 text-start">
                        <span class="badge filter bg-gradient-primary active" data-color="primary"
                            onclick="sidebarColor(this)"></span>
                        <span class="badge filter bg-gradient-dark" data-color="dark"
                            onclick="sidebarColor(this)"></span>
                        <span class="badge filter bg-gradient-info" data-color="info"
                            onclick="sidebarColor(this)"></span>
                        <span class="badge filter bg-gradient-success" data-color="success"
                            onclick="sidebarColor(this)"></span>
                        <span class="badge filter bg-gradient-warning" data-color="warning"
                            onclick="sidebarColor(this)"></span>
                        <span class="badge filter bg-gradient-danger" data-color="danger"
                            onclick="sidebarColor(this)"></span>
                    </div>
                </a>
                <!-- Sidenav Type -->
                <div class="mt-3">
                    <h6 class="mb-0">Sidenav Type</h6>
                    <p class="text-sm">Choose between 2 different sidenav types.</p>
                </div>
                <div class="d-flex">
                    <button class="btn bg-gradient-dark px-3 mb-2 active" data-class="bg-gradient-dark"
                        onclick="sidebarType(this)">Dark</button>
                    <button class="btn bg-gradient-dark px-3 mb-2 ms-2" data-class="bg-transparent"
                        onclick="sidebarType(this)">Transparent</button>
                    <button class="btn bg-gradient-dark px-3 mb-2 ms-2" data-class="bg-white"
                        onclick="sidebarType(this)">White</button>
                </div>
                <p class="text-sm d-xl-none d-block mt-2">You can change the sidenav type just on desktop view.</p>
                <!-- Navbar Fixed -->
                <div class="mt-3 d-flex">
                    <h6 class="mb-0">Navbar Fixed</h6>
                    <div class="form-check form-switch ps-0 ms-auto my-auto">
                        <input class="form-check-input mt-1 ms-auto" type="checkbox" id="navbarFixed"
                            onclick="navbarFixed(this)">
                    </div>
                </div>
                <hr class="horizontal dark my-3">
                <div class="mt-2 d-flex">
                    <h6 class="mb-0">Light / Dark</h6>
                    <div class="form-check form-switch ps-0 ms-auto my-auto">
                        <input class="form-check-input mt-1 ms-auto" type="checkbox" id="dark-version"
                            onclick="darkMode(this)">
                    </div>
                </div>
                <hr class="horizontal dark my-sm-4">
                <a class="btn bg-gradient-info w-100"
                    href="https://www.creative-tim.com/product/material-dashboard-pro">Free Download</a>
                <a class="btn btn-outline-dark w-100"
                    href="https://www.creative-tim.com/learning-lab/bootstrap/overview/material-dashboard">View
                    documentation</a>
                <div class="w-100 text-center">
                    <a class="github-button" href="https://github.com/creativetimofficial/material-dashboard"
                        data-icon="octicon-star" data-size="large" data-show-count="true"
                        aria-label="Star creativetimofficial/material-dashboard on GitHub">Star</a>
                    <h6 class="mt-3">Thank you for sharing!</h6>
                    <a href="https://twitter.com/intent/tweet?text=Check%20Material%20UI%20Dashboard%20made%20by%20%40CreativeTim%20%23webdesign%20%23dashboard%20%23bootstrap5&amp;url=https%3A%2F%2Fwww.creative-tim.com%2Fproduct%2Fsoft-ui-dashboard"
                        class="btn btn-dark mb-0 me-2" target="_blank">
                        <i class="fab fa-twitter me-1" aria-hidden="true"></i> Tweet
                    </a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https://www.creative-tim.com/product/material-dashboard"
                        class="btn btn-dark mb-0 me-2" target="_blank">
                        <i class="fab fa-facebook-square me-1" aria-hidden="true"></i> Share
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!--   Core JS Files   -->
    <script src="../assets/js/core/popper.min.js"></script>
    <script src="../assets/js/core/bootstrap.min.js"></script>
    <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
    <script src="../assets/js/plugins/chartjs.min.js"></script>
    <script>
        var ctx2 = document.getElementById("chart-line").getContext("2d");
        $(document).ready(
            function () {
                console.log("Inside ABSEBTEEISM RATE LIST");
                let today = new Date(); //today's date
                let formattedDate = today.toISOString().split('T')[0]; console.log(formattedDate);
                // getMonth() results in 0-indexed,i.e., January = 0
                console.log("YEAR: ", today.getFullYear());
                $.get(`http://127.0.0.1:8000/abc/absenteeism_rate_list/${today.getFullYear()}`)
                    .done(
                        function (response) {
                            if (response.status === 1) {
                                const rate_list = response.msg;
                                console.log(rate_list)
                                var rate_arr = [];
                                for (let ele of rate_list) {
                                    rate_arr.push(ele.rate);
                                }
                                console.log(rate_arr)
                                var ctx2 = document.getElementById("chart-line").getContext("2d");
                                new Chart(ctx2, {
                                    type: "line",
                                    data: {
                                        labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                                        datasets: [{
                                            //label: "Mobile apps",
                                            tension: 0,
                                            borderWidth: 0,
                                            pointRadius: 5,
                                            pointBackgroundColor: "rgba(255, 255, 255, .8)",
                                            pointBorderColor: "transparent",
                                            borderColor: "rgba(255, 255, 255, .8)",
                                            borderWidth: 4,
                                            backgroundColor: "transparent",
                                            fill: true,
                                            data: rate_arr,
                                            maxBarThickness: 6

                                        }],
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        plugins: {
                                            legend: {
                                                display: false,
                                            }
                                        },
                                        interaction: {
                                            intersect: false,
                                            mode: 'index',
                                        },
                                        scales: {
                                            y: {
                                                grid: {
                                                    drawBorder: false,
                                                    display: true,
                                                    drawOnChartArea: true,
                                                    drawTicks: false,
                                                    borderDash: [5, 5],
                                                    color: 'rgba(255, 255, 255, .2)'
                                                },
                                                ticks: {
                                                    display: true,
                                                    color: '#f8f9fa',
                                                    padding: 10,
                                                    font: {
                                                        size: 14,
                                                        weight: 300,
                                                        family: "Roboto",
                                                        style: 'normal',
                                                        lineHeight: 2
                                                    },
                                                }
                                            },
                                            x: {
                                                grid: {
                                                    drawBorder: false,
                                                    display: false,
                                                    drawOnChartArea: false,
                                                    drawTicks: false,
                                                    borderDash: [5, 5]
                                                },
                                                ticks: {
                                                    display: true,
                                                    color: '#f8f9fa',
                                                    padding: 10,
                                                    font: {
                                                        size: 14,
                                                        weight: 300,
                                                        family: "Roboto",
                                                        style: 'normal',
                                                        lineHeight: 2
                                                    },
                                                }
                                            },
                                        },
                                    },
                                });

                            } else {
                                console.error("Error: ", response.error);
                            }
                        }
                    )
                    .fail(
                        function (error) {
                            console.error("Error fetching data: ", error);
                        }
                    );
            }
        );

        var ctx3 = document.getElementById("chart-line-tasks").getContext("2d");

        new Chart(ctx3, {
            type: "line",
            data: {
                labels: ["Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                datasets: [{
                    label: "Mobile apps",
                    tension: 0,
                    borderWidth: 0,
                    pointRadius: 5,
                    pointBackgroundColor: "rgba(255, 255, 255, .8)",
                    pointBorderColor: "transparent",
                    borderColor: "rgba(255, 255, 255, .8)",
                    borderWidth: 4,
                    backgroundColor: "transparent",
                    fill: true,
                    data: [50, 40, 300, 220, 500, 250, 400, 230, 500],
                    maxBarThickness: 6

                }],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false,
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index',
                },
                scales: {
                    y: {
                        grid: {
                            drawBorder: false,
                            display: true,
                            drawOnChartArea: true,
                            drawTicks: false,
                            borderDash: [5, 5],
                            color: 'rgba(255, 255, 255, .2)'
                        },
                        ticks: {
                            display: true,
                            padding: 10,
                            color: '#f8f9fa',
                            font: {
                                size: 14,
                                weight: 300,
                                family: "Roboto",
                                style: 'normal',
                                lineHeight: 2
                            },
                        }
                    },
                    x: {
                        grid: {
                            drawBorder: false,
                            display: false,
                            drawOnChartArea: false,
                            drawTicks: false,
                            borderDash: [5, 5]
                        },
                        ticks: {
                            display: true,
                            color: '#f8f9fa',
                            padding: 10,
                            font: {
                                size: 14,
                                weight: 300,
                                family: "Roboto",
                                style: 'normal',
                                lineHeight: 2
                            },
                        }
                    },
                },
            },
        });
    </script>
    <script>
        var win = navigator.platform.indexOf('Win') > -1;
        if (win && document.querySelector('#sidenav-scrollbar')) {
            var options = {
                damping: '0.5'
            }
            Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
        }
    </script>
    <!-- Github buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="../assets/js/material-dashboard.min.js?v=3.1.0"></script>
</body>

</html>